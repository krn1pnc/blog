---
title: 梦熊 2023 炼石计划 做题记录
date: 2023-11-29 14:33:20
categories: 做题记录
---

## 11 月 23 日

### * A. 座号重分配

注意到

$$
a_i b_j+a_j b_k+a_k b_i \ge a_k b_j+a_j b_i+a_i b_k \iff (a_k - a_j)(b_i - b_j) - (a_i - a_j)(b_k - b_j) \ge 0
$$

故若令 $A_i = (a_i, b_i)$，那么有 $\overrightarrow{A_iA_{i + 1}} \times \overrightarrow{A_{i + 1}A_{i + 2}} \ge 0$，每次跑一次凸包，删去凸包上的点后解决子问题，然后枚举凸包上的点看如何拼接．

### * B. 实习生分配

唐．

不妨枚举 $a, b$ 的最大值 $p, q$，那么为了最小化部门 Y 的价值，$a_i \le p$ 且 $b_i \le q$ 的点全都发配到部门 X 一定不劣．按照 $p$ 降序扫描线，过程中对每个 $q$ 维护 $\max c_i + \max d_i + q$，修改形如全局取 $\max$，由于初始状态是通过前缀取 $\max$ 得到的，故事实上是区间覆盖．容易使用线段树维护，注意需要精细地保证 X 和 Y 部门都有人．

### ! C. 城镇分配

还没补．

## 11 月 26 日

### * A. 白云一片去悠悠

我们选取一个联通块中最小的且最靠左上方的元素作为这个连通块的特征元素，对联通块计数即对特征元素计数．

考虑一个元素 $(i, j)$ 何时能够成为特征元素．如果它往四个方向直走，只经过合法的格子，能够走到一个权值比自己小的格子，那么它肯定不是特征元素．现在我们尝试证明，从某个格子开始，若其上下左右四个方向上第一个权值比自己小的格子都无法通过直走到达，那么它就是一个特征元素．采用反证法，不妨设它能走到它上方的那个比自己小的格子，那么它需要绕过挡住自己的那个格子，不妨设路径是 $(i, j) \to (i, k) \to (p, k) \to (p, j)$，那么有 $b_k < b_j$，那么有 $a_i + b_k < a_i + b_j$，即 $w_{i, k} < w_{i, j}$，与四个方向上都走不到矛盾．

故设 $\mathrm{pa}_i$ 为最大的 $j$ 满足 $a_j < a_i$，$\mathrm{sa}_i$ 为最小的 $j$ 满足 $a_j < a_i$，$\mathrm{pb}_i, \mathrm{sb}_i$ 类似．那么就是求有多少点对 $(i, j)$ 满足

$$
\begin{aligned}
a_i + b_j \le x \\
a_i + \min\{\max_{k = \mathrm{pb}_j}^{j} b_k, \max_{k = j}^{\mathrm{sb}_j} b_k\} > x \\
b_j + \min\{\max_{k = \mathrm{pa}_i}^{i} a_k, \max_{k = i}^{\mathrm{sa}_i} a_k\} > x
\end{aligned}
$$

扫描线即可．

### * B. 模板性二维数点

假设我们设定了阈值 $x$，只考虑 $a_i^y < x, b_j^y > x$ 的情况，发现选取出的点对一定至少包含一个两边的最大值．考虑对 $y$ 轴分治，求出可能成为答案的点对，容易发现个数是 $O(n \log n)$．

然后扫描线即可．

### * C. 多刀流

分类讨论．

1. $m = n$ 时，只需判断整个串是否单调升，若不是则可行．
1. $m = 2$ 时，枚举分界点．
1. $m = 3$ 时，考虑是 $T_1 > T_2$ 还是 $T_2 > T_3$．

    1. $T_1 > T_2$ 时，可以被调整到 $|T_2| = 1$，直接枚举即可．
    1. $T_2 > T_3$ 时，考虑最终的划分方案：

        1. $T_2$ 中存在字符大于 $T3$ 中的字符，可以调整使得 $|T_2| = 1$．
        1. 剩下的情况，$T_2$ 中只包含一种字符，且最大化 $|T_2|$ 是最优的．

        于是直接枚举连续段作为 $T_2$ 即可．

1. $m \ge 4$ 时，只需找到一个位置 $i$ 使得 $s_i > s_{i + 1}$ 或 $s_i = s_{i + 1} = s_{i + 2}$ 即可．

## 11 月 30 日

### * A. 种豆南山

一种作物分布唯一对应一个最小的能够将所有有作物的格子框住的矩形，我们称这个矩形为这个分布的特征矩形．

考虑枚举矩形，计算特征矩形为当前矩形的分布个数．需要很麻烦的分讨．咕咕咕咕．

### ! B. 长城烽火

还没补．

### ! C. 光明教会

还没补．

## 12 月 10 日

没打．

## 12 月 14 日

### * A. 帮派斗争

### * B. 轨道对齐

回想到对于一个序列 $a_i$，存在 $k$ 次多项式 $P(x)$ 满足 $P(i) = a_i$ 的充要条件是 $a$ 的 $k + 1$ 阶差分全为 $0$．

故只用找到 $b$ 的一个循环位移，使得其的 $k + 1$ 阶差分和 $a$ 的 $k + 1$ 阶差分相同．可以轻松使用哈希解决，问题是如何快速计算高阶差分．

考查 $k + 1$ 阶差分的表达形式：

$$
\Delta^n a_i = \sum_j \binom{k + 1}{j} (-1)^{k + 1 - j} a_{i + j}
$$

是一个卷积的形式，直接 FFT 加速卷积即可．

### ! C. 增长序列

还没补．

## 12 月 17 日

### A. game

若我们预处理出了 $f_{i, j}$ 表示 $(1, 1)$ 向右下走到 $(i, j)$ 的最大权值和 $g_{i, j}$ 表示 $(R, C)$ 向左上走到 $(i, j)$ 的最大权值．

若 Bob 的路径已经确定，那么可以通过尝试拼接路径两侧的 $f$ 和 $g$ 数组来计算当前局面上 Alice 的最大权值和．把这个过程丢到一个 DP 里就可以解决本题．

具体地，设 $h_{i, j, 0 / 1}$ 表示 Bob 从 $(1, C)$ 向左下走到 $(i, j)$，上一步是横 / 竖着走的（为了提前计算拐角处贡献），Alice 的最小的最大收益．转移尝试拼上一段竖 / 横着的路径和路径末端的拐角即可．

### * B. 永无宁日 II

shaber 点分治题．

考虑计算跨越一个点 $r$ 的所有路径的贡献．对于当前的 $r$，计算连通块内所有点到 $r$ 后的危险度是多少，若不能到达就设为 $\infty$，记为 $\mathrm{up}_u$．为了计算 $\mathrm{up}_u$，我们记录 $\mathrm{rem}_u$ 表示危险度为 $\le \mathrm{rem}_u$ 的人进入 $u$ 后能够到达 $r$，有转移：

$$
\mathrm{rem}_v \leftarrow \min\{\mathrm{rem}_u - d_v, k_v\}
$$

若当前在 $u$，判定其子节点 $v$ 可达的条件为 $d_v \le \mathrm{rem}_u$．

再记 $\mathrm{dn}_u$ 表示危险度 $\le \mathrm{dn}_u$ 的人可以从 $r$ 走到 $u$．为了计算 $\mathrm{dn}_u$，我们需要记录 $s_u$ 表示 $r$ 到 $u$ 的路径上，除了 $r$ 的所有节点的权值和．有转移：

$$
\mathrm{dn}_v \leftarrow \min\{\mathrm{dn}_u, k_v - \mathrm{sum}_u\}
$$

那么相当于统计满足 $a_u \le a_v$ 且 $\mathrm{up}_u \le \mathrm{dn}_v$ 的点对 $(u, v)$ 数目，是经典的二维数点问题，扫描线即可．总复杂度为 $O(n \log^2 n)$．

### ! C. 穿梭

还没补．

## 12 月 21 日

### A. 指数爆炸

注意到幂塔只有前 30 个位置有用，故倒着 DP，转移只枚举前 30 个位置，后面的直接前缀和计算．

然后这 b 题卡常，注意到计算幂塔的模数除开前三个（分别为 $998244353, 998244352, 402653184$）均为 $2$ 的整数次幂，故使用位运算优化取模．时间复杂度 $O(n \log^3 V)$．

### * B. 购物博弈

考虑对每个左端点 $i$ 计算最小的 $f_i$，使得给 $[i, f_i]$ 这一段涨价后满足要求．答案即为 $\sum n - f_i + 1$．

注意到 $b_i > a_i$，故 $f_i$ 单调增．考虑整体二分．设当前答案值域为 $[\mathrm{pl}, \mathrm{pr}]$，对应 $f$ 的下标值域为 $[l, r]$．令 $\mathrm{pmid} = \lfloor (\mathrm{pl} + \mathrm{pr}) / 2 \rfloor$，考虑计算区间 $[l, r]$ 中最大的 $i$ 满足使 $[i, \mathrm{pmid}]$ 涨价后满足题目要求．由于 $f$ 有单调性，这个也可以二分！

复杂度貌似是 $O(nV \log n)$，但是非常不满！跑得很快．

### * C. 保守主义

垃圾东西．注意到字母对很少，考虑将询问离线，逐一计算每一对字母对询问的贡献．

对于字母对 $(c_1, c_2)$，我们可以将序列中除了 $c_1$ 和 $c_2$ 的数去掉，然后将 $c_1$ 变成 $1$，$c_2$ 变成 $0$，即求端点间的连续段数．容易使用前缀和解决，时间复杂度 $(n|\Sigma| + m|\Sigma|^2)$．

## 12 月 24 日

### * A. 学习小组

记数字 $i$ 的出现次数为 $\mathrm{ct}_i$．对于参数 $p$，答案由下式给出：

$$
\left\lfloor \frac{\sum_{i} \min\{\mathrm{ct}_i, \mathrm{ct}_{p - i}\}}{2} \right\rfloor
$$

考虑如何计算分子，发现是个卷积的形式．又注意到 $\mathrm{ct}_i$ 的不同取值只有 $O(\sqrt{n})$ 种，故考虑枚举 $x$，对所有 $\mathrm{ct}_i = x$ 的 $i$ 计算贡献．分子可转写成下式：

$$
\sum_x \sum_{i} [\mathrm{ct}_i = x][\mathrm{ct}_{p - i} \le x] \mathrm{ct}_{p - i} + \sum_i [\mathrm{ct}_i = x][\mathrm{ct}_{p - i} > x] \mathrm{ct}_i
$$

后两部分都是卷积的形式，使用 FFT 加速计算即可．

这样做的复杂度是 $O(\sqrt{n} m \log m)$，过不去．

注意到我们还有个简单 $O(n^2)$ 的暴力．考虑设置阈值 $B$，$\mathrm{ct}$ 中出现次数 $\le B$ 的值跑暴力，这部分复杂度是 $O((n / B)^2)$；$\mathrm{ct}$ 中出现次数 $> B$ 的值跑 FFT，这部分复杂度为 $O(B m \log m)$．视 $n, m$ 同阶，取 $B = O\left((n / \log n)^{1 / 3}\right)$ 平衡，复杂度 $O(n^{4 / 3} \log^{2 / 3} n)$．

### * B. 树国路径普查

考虑分治，计算跨越分治区间中点的区间贡献．

设分治区间为 $[l, r]$，终点为 $\mathrm{mid}$．对于 $i \in [l, \mathrm{mid}]$，$j \in (\mathrm{mid}, r]$，区间 $[i, j]$ 的直径可能有三种贡献途径：全由 $[i, \mathrm{mid}]$ 贡献，全由 $(\mathrm{mid}, j]$ 贡献，剩下的称为跨 $\mathrm{mid}$ 贡献．

通过画画画画画画可以发现，对于一个 $i$，$(\mathrm{mid}, r]$ 可被划分成三部分：对于 $j \in (\mathrm{mid}, x]$，$[i, j]$ 的直径由 $[i, \mathrm{mid}]$ 贡献；对于 $(x, y]$，$[i, j]$ 的直径属于跨 $\mathrm{mid}$ 贡献；对于 $j \in (y, r]$，$[i, j]$ 的直径由 $(\mathrm{mid}, j]$ 贡献．且随着 $i$ 减小，$x$ 和 $y$ 都单调不降，使用两个指针维护．前两类贡献是好算的，考虑如何计算跨 $\mathrm{mid}$ 贡献．

问题在于拼接两个区间的直径．注意到如果我们计算出点集的“半径”和“圆心”，点集并的直径长度等于两点集的半径和加上圆心间的距离．半径和容易维护，圆心间的距离造成的贡献形如某个点到区间所有点的距离和，使用 [经典技巧](https://www.luogu.com.cn/problem/P4211) 即可快速计算．

### ! C. 简单环检测

带卡时的暴力过了．/qd

## 12 月 28 日

### * A. Rick 的跨年晚会

设 $f_{i, j}$ 表示从后往前考虑到了 $i$，文艺值当前等于 $l_i$ 的有 $j$ 人．转移枚举下一个选 $k$，有

$$
\begin{cases}
  f_{k, j + 1} \leftarrow f_{i, j} + c_{l_k} - s_k & l_k = l_i \\
  f_{k, t + 1} \leftarrow f_{i, j} + c_{l_k} - s_k + \mathrm{tot} & l_k > l_i
\end{cases}
$$

其中 $t$ 是 $j$ 个人从 $l_i$ “进位”到 $l_k$ 所剩下的人数，$\mathrm{tot}$ 是该过程中造成的贡献．由于每次进位除 $2$，故对于一个 $j$，能取的 $t$ 只有 $\log j$ 种，开桶统计．$t = 0$ 时的转移会影响到 $k < i, l_k \ge l_i$ 的所有位置，开树状数组统计．

### * B. 修剪仙人掌

先把每个环边上的颜色薅出来．由于每个环上至少要删一条边，故问题可以被写成一个匹配的形式：我们将每种颜色的边保留一条，然后让剩下的边和环上的颜色匹配．若匹配满了，那么存在一种不消耗颜色的删边方式，直接输出颜色数；若有环未被匹配，说明无论如何都要消耗一种颜色．故答案为 $c - (r - m)$，其中 $c$ 是颜色数，$r$ 是环数，$m$ 是匹配数．

直接建图跑网络流即可．由于是二分图，故时间复杂度 $O(n \sqrt{n})$．

### * C. 直径检查器

$\Huge\color{red}\text{没写完代码．}$

tsukiotome．
